<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">

    <title>Hello, world!</title>

    <style>
      h6#result {
        max-height: 300px;
        overflow-y: scroll;
      }
      .CRUDdb-div {
        position: absolute;
        width: 100%;
        left: 0;
      }
      @media (min-width: 576px) {
        #add-car-todb input#add-field {
            width: 70%;
        }
        #add-car-todb input.form-control.btn.btn-info {
            width: 30%;
        }
      } 
      .n-btn {
          background: transparent;
          color: transparent;
          border: none;
          width: 15px;
          height: 15px;
          margin: 0px 5px;
          transition: transform .4s ease-in-out, opacity .3s ease-in-out;
          opacity: 0;
          z-index: 9;
          cursor: pointer;
          background-position: center;
          background-repeat: no-repeat;
          background-size: contain;
      }
      #table tbody tr .n-btn:hover {
          opacity: 1 !important;
          transform: scale(1.1) !important;
      }
      #table tbody tr:hover .n-btn {
          opacity: .5;
      }
      .delete-btn {
        transform: translateX(-15px) rotate(160deg) scale(.8);
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMyA4djE2aDE4di0xNmgtMTh6bTUgMTJjMCAuNTUyLS40NDggMS0xIDFzLTEtLjQ0OC0xLTF2LThjMC0uNTUyLjQ0OC0xIDEtMXMxIC40NDggMSAxdjh6bTUgMGMwIC41NTItLjQ0OCAxLTEgMXMtMS0uNDQ4LTEtMXYtOGMwLS41NTIuNDQ4LTEgMS0xczEgLjQ0OCAxIDF2OHptNSAwYzAgLjU1Mi0uNDQ4IDEtMSAxcy0xLS40NDgtMS0xdi04YzAtLjU1Mi40NDgtMSAxLTFzMSAuNDQ4IDEgMXY4em00LTE1LjM3NWwtLjQwOSAxLjk1OC0xOS41OTEtNC4wOTkuNDA5LTEuOTU4IDUuNTI4IDEuMDk5Yy44ODEuMTg1IDEuODItLjc0MiAyLjAwNC0xLjYyNWw1LjIwNCAxLjA4NmMtLjE4NC44ODIuMzA3IDIuMTA3IDEuMTg5IDIuMjkxbDUuNjY2IDEuMjQ4eiIvPjwvc3ZnPg==);

      }
      .edit-btn {
          transform: translateX(-25px) rotate(-160deg) scale(.8);
          background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTQuMDc4IDQuMjMybC0xMi42NCAxMi42MzktMS40MzggNy4xMjkgNy4xMjctMS40MzggMTIuNjQxLTEyLjY0LTUuNjktNS42OXptLTEwLjM2OSAxNC44OTNsLS44NS0uODUgMTEuMTQxLTExLjEyNS44NDkuODQ5LTExLjE0IDExLjEyNnptMi4wMDggMi4wMDhsLS44NS0uODUgMTEuMTQxLTExLjEyNS44NS44NS0xMS4xNDEgMTEuMTI1em0xOC4yODMtMTUuNDQ0bC0yLjgxNiAyLjgxOC01LjY5MS01LjY5MSAyLjgxNi0yLjgxNiA1LjY5MSA1LjY4OXoiLz48L3N2Zz4=);
          transition-delay: .1s;
      }
      #table tbody tr:hover .delete-btn, #table tbody tr:hover .edit-btn  {
          transform: translateX(0);    
      }

      #table tbody tr td:first-child {
        width: 10%;
      }
      #table tbody tr td:nth-child(2) {
          /* width: 80%; */
      }
      #table tbody tr td:nth-child(3), #table thead tr th:nth-child(3) {
          /* width: 10%; */
          padding: .75rem 0;
      }
      #table tbody tr td .cars {
        margin: 0;
        position: relative;
      }
      #table tbody tr td .cars:focus {
          background: rgba(0, 0, 0, 0.08);
          outline: none;  
      }
      #table tbody tr td .cars:before {
          content: "";
          width: 15px;
          height: 15px;
          background: rgba(0, 0, 0, 0);
          position: absolute;
          background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTQuMDc4IDQuMjMybC0xMi42NCAxMi42MzktMS40MzggNy4xMjkgNy4xMjctMS40MzggMTIuNjQxLTEyLjY0LTUuNjktNS42OXptLTEwLjM2OSAxNC44OTNsLS44NS0uODUgMTEuMTQxLTExLjEyNS44NDkuODQ5LTExLjE0IDExLjEyNnptMi4wMDggMi4wMDhsLS44NS0uODUgMTEuMTQxLTExLjEyNS44NS44NS0xMS4xNDEgMTEuMTI1em0xOC4yODMtMTUuNDQ0bC0yLjgxNiAyLjgxOC01LjY5MS01LjY5MSAyLjgxNi0yLjgxNiA1LjY5MSA1LjY4OXoiLz48L3N2Zz4=);
          background-position: center;
          background-size: contain;
          left: -15px;
          top: 5px;
          opacity: 0;
          transform: translateX(15px) rotate(45deg);
          transition: opacity .3s ease-in-out, transform .3s ease-in-out;
      }
      #table tbody tr td .cars:focus:before {
          opacity: .5;
          transform: scale(1);
      }
      tr.update-div td {
          position: absolute;
          width: 100% !important;
          padding: 0;
      }

      tr.update-div {
          display: none;
      }

      tr.update-div #update-car-todb {
          max-width: 100%;
      }
      tr.update-div #update-car-todb #update-field {
          width: 80%;
      }

      tr.update-div #update-car-todb input[type="submit"] {
          width: 20%;
      }
      #table tbody tr {
          position: relative;
      }


    </style>


  </head>


  <body>
    <div class="container" id="container">
      




      <div class="row justify-content-md-center ">
        <div class="col-sm-6 text-center ">
          <br><br>
          <h2>Search Our Database</h2>
          <br>
          <input id="search" class="form-control" type="text" placeholder="Search our inventory..." name="search">
          <h6 id="result" class="mb-2 text-left"></h6>
        </div>
      </div>





      <div class="row"><br><br></div>



    <div class="row justify-content-md-center ">
      <form id="add-car-todb" class="col-sm-6 text-center form-inline form-group" action="new-car.php" method="POST">
        <input  type="text" name="car_name" id="add-field" class="form-control" placeholder="Add a new car to the list">
        <input  type="submit" class="form-control btn btn-info" value="ADD CAR">
      </form>
    </div>



    <div class="row"><br><br></div>



    <div class="row justify-content-md-center ">
      <div class="col-sm-6 text-center">

        <table id="table" class="table" >
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Cars name</th>
                <th></th><th></th>
              </tr>
            </thead>
            <tbody></tbody>
        </table>  

      </div>
    </div>







 </div> <!-- container -->



    

   






    
    

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4" crossorigin="anonymous"></script>



    <script>
    
      $(document).ready(function(){









        // Show the date form DB
        function showData(){


          $.ajax({
            url: 'show-cars.php',
            data: 'show-cars',
            type: 'GET',

            success: function(data){
              $('#table tbody').html(data);
              eventToCars();
              tabaleBTNS();
            },

            error: function(data) {
              CRUDdb('alert-danger', 'ERROR!!! Something goes wrong on the Table list');
            }

   
          });
        }
        showData();


        // Event to carl list data
        function eventToCars(){
          $('a.cars').click(function(e){
            e.preventDefault();
            //alert(e);
            //console.log(e);
          });
        }
        









        // Search from DB 
        $('#search').keyup(function(){

          var search = $('#search').val();

          $.ajax({
            url:     'search.php',
            data:    { key:search },
            type:    'POST',

            success: function(data){
              if(!data.error){
                $('#result').html(data);
              }
            },
            error: function(data) {
              CRUDdb('alert-danger', 'ERROR!!! Something goes wrong');
            }
              
  
          });

        });









        // Add to DB 
        $('#add-car-todb').submit(function(e){

          e.preventDefault();
          var postData = $(this).serialize();
          var url = $(this).attr('action');
          var success = false;

          $.post(url, postData, function(php_table_data){

             CRUDdb('alert-success', 'Car added to to the stock :)');
             $('#add-field').val('');
             success = true;
             showData()
          });

          if ( success ){
            CRUDdb('alert-danger', 'ERROR!!! Something goes wrong :(');
          }
        });





        function tabaleBTNS() { 


          $('.n-btn.delete-btn').click(function(){

            var id = $(this).attr('data-id');
            //console.log('delete-btn ID ' + id + ' clicked');

            $.ajax({
              url: 'delete.php',
              data: { delete:id },
              type: 'POST',
              
              success: function(data){
                if(!data.error){
                  //alert('data');
                  showData();
                }
              },
              error: function(data) {
                alert('ERORR delete-btn ID ' + id + ' clicked');
              }

            });

          });

          
          /*
          $('.n-btn.edit-btn').click(function(){
          console.log('edit-btn clicked');
          });
          */




          $('#table tbody tr td .cars').on( "blur", function(){

            var val = $(this).text();
            var id  = $(this).attr('data-id');


            $.ajax({
              url: 'update.php',
              data: { 
                id:id,
                val:val
              },
              type: 'POST',
              
              success: function(data){
                if(!data.error){
                  showData();
                }
              },
              error: function(data) {
                alert('ERORR Update car No.' + id + 'failed' );
              }

            });



          });

          

        }









        // add success/error message CRUD db 
        function CRUDdb ( cssClass, message ) { 
          
          $('<p class="alert '+ cssClass +' CRUDdb-div">'+ message +'</p>').insertBefore($('#container > div:first-child'));

          setTimeout( function(){
             $('.CRUDdb-div').fadeOut('slow');
          } , 5000);

          setTimeout( function(){
             $('.CRUDdb-div').remove();
          } , 5500);
        }
  








      }); // document ready
        
        
    </script>


  </body>
</html>